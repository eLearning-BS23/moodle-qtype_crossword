define ("qtype_crossword/crossword",["jquery"],function(a){return{setup:function setup(b){var W=[];function c(){return!1}function d(){return!0}function e(){a(".word-clue").click(function solvefunction(){a("#solution-answer").val("");a("#answer-results").hide();a("#answer-results").html("");var b=a(this).attr("data-word"),c="false"==a(this).attr("data-across")?"Down":"Across";a("#position-and-clue").html("<b>"+c+"</b> : "+a(this).attr("data-clue"));a("#answer-form").show();if(a(this).children("span").attr("data-solved")){a("#answer-button").attr("disabled",!0);a("#answer-results").show();a("#answer-results").html("You have already solved this problem.");a("#solution-answer").val(b)}else{a("#solution-answer").attr("maxlength",b.length);a("#answer-button").attr("data-word",b);var d=a(this).attr("data-x");a("#answer-button").attr("data-x",d);var e=a(this).attr("data-y");a("#answer-button").attr("data-y",e);var f=a(this).attr("data-across");a("#answer-button").attr("data-across",f);a("#solution-answer").focus();a("#answer-button").attr("disabled",!1)}return!1});a("#cancel-button").click(function closesolvefunction(){a("#answer-results").hide();a("#answer-form").hide();return!1});a("#answer-button").click(function answerfunction(){var b=a(this).attr("data-word"),c=a("#solution-answer").val().toLowerCase();if(c==b){var d=a(this).attr("data-across"),e=parseInt(a(this).attr("data-x"),10),f=parseInt(a(this).attr("data-y"),10);if(d&&"false"!=d){for(var g=0;g<c.length;g++){var h=f+g,j="letter-position-"+e+"-"+h;a("#"+j).text(c[g])}}else{for(var g=0;g<c.length;g++){var k=e+g,j="letter-position-"+k+"-"+f;a("#"+j).text(c[g])}}a("#"+b+"-listing").addClass("strikeout");a("#"+b+"-listing").attr("data-solved",!0);a("#answer-form").hide()}else{if(!a("#answer-results").is(":visible")){a("#answer-results").show();a("#answer-results").html("Incorrect Answer, Please Try Again")}}return!1});a("#reveal-answer-button").click(function revealanswerfunction(){var b=a(this).attr("data-word"),c=a(this).attr("data-across"),d=parseInt(a(this).attr("data-x"),10),e=parseInt(a(this).attr("data-y"),10);if(c&&"false"!=c){for(var f=0;f<b.length;f++){var g=e+f,h="letter-position-"+d+"-"+g;a("#"+h).text(b[f])}}else{for(var f=0;f<b.length;f++){var j=d+f,h="letter-position-"+j+"-"+e;a("#"+h).text(b[f])}}a("#"+b+"-listing").addClass("crossword-red-strikeout");a("#"+b+"-listing").attr("data-solved",!0);a("#answer-form").hide()})}function f(b,c,d){var e=b.across,f=b.down,i=h(e),j=h(f,e,i),k=g(i,c,!0,d),l=g(j,c,!1,d);a("#left-list").append(k);a("#right-list").append(l)}function g(a,b,c,d){for(var e=Object.keys(a),f="<ul>",g=0;g<e.length;g++){var h=e[g],j=a[h],k=j.word,l=j.coordinates,m=d[k];f+="<input type=\"hidden\" id=\""+m.replace(/"/g,"&quot;");f+="\" onblur=\"onBlurFuntion(this.value,"+l[0];f+=","+l[1]+","+c+")\"";f+="data-x=\""+l[0]+"\" ";f+="data-y=\""+l[1]+"\" ";f+="data-across=\""+c+"\" ";f+=">";f+="</input>"}f+="</ul>";return f}function h(b,c,d){for(var e=[],f=0,g=0;g<b.length;g++){f++;var h=b[g],k=h.word,l=h.position,m=j(l,c,d),n=f;if(m){n=m}var o="<div class=\"crossword-background-text\"><span class=\"crossword-grid-cell-number\">"+n+"</span></div>",p;p=a("#cell-position-"+l[0]+"-"+l[1]);if(p&&a(p).attr("id")){a(p).prepend(o)}e[f]={word:k,coordinates:l}}return e}function j(a,b,c){if(!b||!b.length||!c||!c.length){return!1}for(var d=0;d<b.length;d++){var e=b[d],f=e.position;if(f[0]==a[0]&&f[1]==a[1]){return k(e.word,c)}}return!1}function k(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d],f=b[e];if(f.word==a){return e}}}function l(b){for(var d=y(b),e=A(b),f=a("<table class=\"crossword-puzzle\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\"></table>"),g=0,h;g<e;g++){h="<tr class=\"letter-row\">";for(var k=0,l;k<d;k++){l="crossword-letter-cell";if(!b[g][k]||" "==b[g][k]){l+=" crossword-blank-cell"}h+="<td id=\"cell-position-"+g+"-"+k+"\" class=\"crossword-relative-position "+l+"\">";h+="<span class=\"crossword-letter-text\" id=\"letter-position-"+g+"-"+k+"\">";if(c()&&b[g][k]&&" "!=b[g][k]){h+=b[g][k]}h+="</span>";h+="</td>"}h+="</tr>";a(f).append(h)}a("#root").append(f);return!0}function m(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d],f=e.across,g=e.word,h=e.matrixpositions,j={word:g,position:h[g]};delete h[g];if(f){if("(unmatched)"!=g){b.push(j)}c=n(c,h)}else{if("(unmatched)"!=g){c.push(j)}b=n(b,h)}}return{across:b,down:c}}function n(a,b){for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d],f=b[e];a.push({word:e,position:f})}return a}function o(a){for(var b=a.shift(),c=b.matrix,d=[{matrixpositions:b.matrixpositions,across:b.across,word:b.word}],e=0;e<a.length;e++){var f=a[e],g=f.matrix,h=f.matrixpositions,k=f.across,l=f.word,m=y(c),n=A(c),o=w(c,g,m,n),x=!1;if(!o){for(var B=!1,C=[],D=99999999,E=0,F;E<c.length;E++){F=r(c[E]);if(0<F.length&&F.length<D){var G=[F.length,E+e],H=s(c,g,G);if(H){D=z(H);B=H;C=G;var I=!0,J=1;while(I&&0<=F.length-J){G=[F.length-J,E+e];var K=s(c,g,G);if(K){D=z(K);B=K;C=G;J++}else{I=!1;J--}}var L=1;while(0<E+e-L){G=[F.length-J,E+e-L];var K=s(c,g,G);if(K){D=z(K);B=K;C=G}L++}L--;I=!0;var J=1;while(I&&0<=F.length-J){G=[F.length-J,E+e-L];var K=s(c,g,G);if(K){D=z(K);B=K;C=G;J++}else{I=!1;J--}}}}}if(B){c=B;h=p(h,[C[1],C[0]]);d.push({matrixpositions:h,across:k,word:l});x=!0}}if(o||!x){for(var N=c.length,O=c[c.length-1],E=0,P;E<m;E++){P=g[0];if(u(O,P)){c=t(c,g);G=[N,E];h=p(h,G);d.push({matrixpositions:h,across:k,word:l});E=m;x=!0}else{g=v(g)}}if(!x){q(g);G=[c.length+1,0];g=M({matrix:g}).matrix;c.push("");c=t(c,g);h=p(h,G);d.push({matrixpositions:h,across:k,word:l})}}c=M({matrix:c}).matrix}var Q={matrix:c,matrixpositions:d};return Q}function p(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return function(c){for(var d=Object.keys(a),c=c,e=0;e<d.length;e++){var f=d[e],g=a[f];g[0]+=b[0];g[1]+=b[1]}return a}(c)}function q(a){var a=a}function r(a){if(!a){return""}return a.replace(/\s+$/,"")}function s(a,b,c){if(0==c[0]||0==c[1]){return!1}var d=a;a=a.slice();for(var e=0,f;e<b.length;e++){f=b[e];for(var g=0;g<f.length;g++){var h=c[0],k=c[1];h+=g;k+=e;if(!a[k]){a[k]=""}if(a[k]&&a[k][h]&&" "!=a[k][h]&&" "!=b[e][g]){return!1}else{if(" "!=b[e][g]){if(d[k-1]&&d[k-1][h]&&" "!=d[k-1][h]){return!1}if(d[k+1]&&d[k+1][h]&&" "!=d[k+1][h]){return!1}if(d[k]&&d[k][h-1]&&" "!=d[k][h-1]){return!1}if(d[k]&&d[k][h+1]&&" "!=d[k][h+1]){return!1}}}while(!a[k][h]){a[k]+=" "}if(" "!=b[e][g]){a[k]=D(b[e][g],a[k],h)}}}return a}function t(a,b){for(var c=a.length,d=0;d<b.length;d++){a[c+d]=b[d]}return a}function u(a,b){var c;if(a[b.length]&&" "==a[b.length]){return!1}if(a.length>b.length){c=b;var d=a}else{c=a;var d=b}for(var e=0;e<c.length;e++){if(c[e]&&d[e]){if(" "!=c[e]&&" "!=d[e]){return!1}}}return!0}function v(a){for(var b=0;b<a.length;b++){a[b]=" "+a[b]}return a}function w(a,b,c,d){if(a.length<=b.length){return!0}else if(d<c){return!0}else if(c<d){return!1}return x()}function x(){return .5<Math.random()?!0:!1}function y(a){for(var b=0,c=0,d;c<a.length;c++){d=a[c];if(d&&d.length&&d.length>b){b=d.length}}return b}function z(a){for(var b=999999,c=0,d;c<a.length;c++){d=a[c];if(d&&d.length<b){b=d.length}}return b}function A(a){return a.length}function B(a){var b=[];for(var c in a){if(!a.hasOwnProperty(c)||"(unmatched)"==c){continue}var e=a[c],f=K(e),g=!0;if(d()){g=x()}var h=[],j=[];if(g){h[f-1]=c;j[c]=[f-1,0];for(var k=0;k<e.length;k++){var l=e[k],m=l[0],n=l[1],o=I(h,c,n,f-2),p=G(m,n);j[m]=[f-p-1,o];h=F(h,m,f-p-1,o)}}else{h=J(h,c,f+1,0);j[c]=[0,f];for(var k=0;k<e.length;k++){var l=e[k],m=l[0],n=l[1],o=H(h,c,n,f-1),p=G(m,n);j[m]=[o,f-p];h=E(h,m,o,f-p)}}var q={matrix:h,matrixpositions:j,across:g,word:c};b.push(q)}if(a["(unmatched)"]){var q=C(a["(unmatched)"]);b.push(q)}return b}function C(a){var b=!0;if(d()){b=x()}var c=[],e=[];if(b){for(var f=0,g;f<a.length;f++){g=a[f];c[f]=g;e[g]=[0,f]}}else{for(var f=0,g;f<a.length;f++){g=a[f];c=F(c,g,0,f);e[g]=[f,0]}}var h={matrix:c,matrixpositions:e,across:!b,word:"(unmatched)"};return h}function D(a,b,c){if(!a){a=" "}return b.substr(0,c)+a+b.substr(c+1)}function E(a,b,c,d){for(var e=0,f;e<b.length;e++){f=e+d;if(!a[c]){a[c]=""}var g=a[c];if(g.length<f){while(g.length<f){g+=" "}g+=b[e]}else{g=D(b[e],g,f)}a[c]=g}return a}function F(a,b,c,d){for(var e=0,f;e<b.length;e++){f=e+c;if(!a[f]){a[f]=""}var g=a[f];if(g.length<d){while(g.length<d){g+=" "}g+=b[e]}else{g=D(b[e],g,d)}a[f]=g}return a}function G(a,b){for(var c=0;c<a.length;c++){if(a[c]==b){return c}}return!1}function H(a,b,c,d){for(var e=0,f;e<b.length;e++){f=b[e];if(!a[e]){a[e]=""}if(c==f&&(!a[e][d]||" "==a[e][d])&&(!a[e][d+2]||" "==a[e][d+2])){return e}}return!1}function I(a,b,c,d){for(var e=0,f;e<b.length;e++){f=b[e];if(!a[d]){a[d]=""}if(c==f&&(!a[d][e]||" "==a[d][e])&&(!a[d+2]||!a[d+2][e]||" "==a[d+2][e])){return e}}return!1}function J(a,b,c){for(var d=Array(c).join(" "),e=0;e<b.length;e++){a[e]=d+b[e]}return a}function K(a){for(var b=0,c=0;c<a.length;c++){var d=a[c],e=d[0].length;if(e>b){b=e}}return b}function L(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.matrix;c=M(c);a[b]=c}return a}function M(a){a=Q(a);a=N(a);a=R(a);a=S(a);return a}function N(b){for(var c=b.matrix,d=b.matrixpositions,e=b.across,f=c.length,g=0;g<f;g++){var h=c[g],j=a.trim(h);if(!h||!j.length){c.splice(g,1);d=O(d);g--;f--}else{g=f}}b.matrix=c;b.matrixpositions=d;return b}function O(a){if(!a){return a}for(var b=Object.keys(a),c=0,d;c<b.length;c++){d=b[c];a[d][0]--}return a}function P(a){if(!a){return a}for(var b=Object.keys(a),c=0,d;c<b.length;c++){d=b[c];a[d][1]--}return a}function Q(b){for(var c=b.matrix,d=b.matrixpositions,e=b.across,f=c.length,g=f-1;0<=g;g--){var h=c[g],j=a.trim(h);if(!j.length){c.splice(g,1)}else{g=-1}}b.matrix=c;b.matrixpositions=d;return b}function R(a){var b=a.matrix,c=a.matrixpositions,d=a.across,e=b.length,f=!0;while(f){if(e){for(var g=0;g<e;g++){if(b[g]){var h=b[g];if(h&&h[0]&&" "!=h[0]){f=!1;g=e}}}}else{f=!1}if(f){for(var g=0,h;g<e;g++){h=b[g];b[g]=h.substr(1,h.length)}c=P(c)}}a.matrix=b;a.matrixpositions=c;return a}function S(a){var b=a.matrix,c=a.matrixpositions,d=a.across,e=y(b)-1,f=b.length,g=!0;while(g){if(f){for(var h=0;h<f;h++){if(b[h]){var j=b[h];if(j[e]&&" "!=j[e]){g=!1;h=f}}}}else{g=!1}if(g){e--;for(var h=0,j;h<f;h++){j=b[h];b[h]=j.substr(0,j.length-1)}}}a.matrix=b;a.matrixpositions=c;return a}function T(a){for(var b=[],c=[],d=[],e=[],f=0;f<a.length;f++){var g=a[f],h=g[0].toLowerCase(),k=g[1];d[h]=k;var l=g[2];e[h]=l;W[h]=k;var m=h+"-"+k,n=[];if(!c[m]){for(var o=U(h),p=[],q=f+1;q<a.length;q++){var r=a[q],s=r[0].toLowerCase(),t=r[1],u=s+"-"+t;if(!c[u]){var v=V(o,s);if(v&&v.length){o[v]--;c[u]=!0;p.push([s,v])}}}if(p.length){b[h]=p}else{n.push(h)}c[m]=!0}if(n.length){b["(unmatched)"]=n}}return{blocks:b,clues:d,fildnames:e}}function U(a){for(var b=[],c=0,d;c<a.length;c++){d=a[c];if(b[d]){b[d]++}else{b[d]=1}}return b}function V(a,b){for(var c="",d=0,e;d<b.length;d++){e=b[d];if(a[e]){return e}}return c}(function(a){var b=a.length;if(!a||!b){return!1}var c=T(a),d=c.blocks,g=c.clues,h=c.fildnames,i=B(d);i=L(i);if(!i||!i.length){return!1}var j=o(i),k=m(j.matrixpositions);l(j.matrix);f(k,g,h);e();return!0})(JSON.parse(b))}}});
//# sourceMappingURL=crossword.min.js.map
